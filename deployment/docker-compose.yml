version: "3.8"

services:
  # Interactive CLI with bash script
  logpress-interactive-bash:
    build:
      context: ..
      dockerfile: deployment/Dockerfile
    image: logpress:latest
    container_name: logpress-interactive-bash
    tty: true
    stdin_open: true
    volumes:
      # Mount data directory (read-only)
      - ../data:/app/data:ro
      # Mount evaluation directory (read-write for outputs)
      - ../evaluation:/app/evaluation
      # Mount scripts directory
      - ../scripts:/app/scripts:ro
    environment:
      - PYTHONUNBUFFERED=1
      - TERM=xterm-256color
    command: ["bash", "scripts/logpress-interactive.sh"]

  # Interactive CLI with Python rich
  logpress-interactive:
    build:
      context: ..
      dockerfile: deployment/Dockerfile
    image: logpress:latest
    container_name: logpress-interactive
    tty: true
    stdin_open: true
    volumes:
      # Mount data directory (read-only)
      - ../data:/app/data:ro
      # Mount evaluation directory (read-write for outputs)
      - ../evaluation:/app/evaluation
    environment:
      - PYTHONUNBUFFERED=1
      - TERM=xterm-256color
    command: ["python", "-m", "logpress.cli.interactive"]

  # Original compression service
  logpress:
    build:
      context: ..
      dockerfile: deployment/Dockerfile
    image: logpress:latest
    container_name: logpress-compress
    volumes:
      # Mount datasets directory
      - ../data/datasets:/app/data/datasets:ro
      # Mount output directories
      - ../evaluation/compressed:/app/evaluation/compressed
      - ../evaluation/results:/app/evaluation/results
    environment:
      - PYTHONUNBUFFERED=1
      - LOG_LEVEL=INFO
    command: python evaluation/run_full_evaluation.py

  # Query service
  logpress-query:
    build:
      context: ..
      dockerfile: deployment/Dockerfile
    image: logpress:latest
    container_name: logpress-query
    volumes:
      - ../evaluation/compressed:/app/evaluation/compressed:ro
      - ../data/datasets:/app/data/datasets:ro
      - ../evaluation/results:/app/evaluation/results
    environment:
      - PYTHONUNBUFFERED=1
    command: python evaluation/run_query_benchmarks.py
    depends_on:
      - logpress

networks:
  default:
    name: logpress-network
